{"version":3,"sources":["../../src/passport/passport-config.js"],"sourcesContent":["// import LocalStrategy from 'passport-local.Strategy';\n// import bcrypt from 'bcrypt';\nconst LocalStrategy = require('passport-local');\nconst bcrypt = require('bcrypt');\n// import { logger, stream } from '@utils/logger';\n\nfunction initialize(passport, getModetator, getCashier, getUserById) {\n    const authenticateUser = async(req, username, password, done) => {\n\n        let userProfile = null\n\n        if (req.body.loginType == 1) {\n            if (req.body.serialNumber == null) {\n                return done(null, false, \"CashierPass: Bad Request!\");\n            }\n            userProfile = await getCashier(username, req.body.serialNumber)\n\n        } else if (req.body.loginType == 2) {\n            userProfile = await getModetator(username)\n        }\n\n        if (userProfile == null) {\n            console.log(\"no user\")\n            return done(null, false, { message: 'Invalid User!' })\n        }\n\n        const passwordFromDB = userProfile.password\n\n        try {\n            if (userProfile.role_id == 1) {\n                if (await password == userProfile.password_mobile_pos) {\n                    console.log(`${Date.now()} info: =================================`);\n                    console.log(`${Date.now()} info: ===== ðŸŽ–ï¸  Authenticated ðŸŽ–ï¸ ======`);\n                    console.log(`${Date.now()} info: >> Cashier: ${username}`);\n                    console.log(`${Date.now()} info: =================================`);\n                    return done(null, userProfile);\n\n                } else {\n                    console.log('cashier password fail')\n                    return done(null, false, \"CashierPass: Incorrect Password!\");\n                }\n\n            } else {\n                if (await bcrypt.compare(password, passwordFromDB)) {\n                    console.log(`${Date.now()} info: =================================`);\n                    console.log(`${Date.now()} info: ===== ðŸŽ–ï¸  Authenticated ðŸŽ–ï¸ ======`);\n                    console.log(`${Date.now()} info: >> Moderator: ${username}`);\n                    console.log(`${Date.now()} info: =================================`);\n\n                    return done(null, userProfile);\n\n                } else {\n                    console.log('password fail')\n                    return done(null, false, \"ModeratorPass: Incorrect Password!\");\n                }\n            }\n\n        } catch (error) {\n            console.log(\"ERROR yeeeeeeeeeeeeeeeeeeeeeee\")\n            console.log(error);\n            return done(error)\n        }\n    }\n\n    passport.use(new LocalStrategy({ passReqToCallback: true }, authenticateUser))\n    passport.serializeUser((user, done) => done(null, user.id))\n    passport.deserializeUser(async(id, done) => {\n        return done(null, await getUserById(id))\n    })\n}\n\nmodule.exports = initialize"],"names":["LocalStrategy","require","bcrypt","initialize","passport","getModetator","getCashier","getUserById","authenticateUser","req","username","password","done","userProfile","body","loginType","serialNumber","console","log","message","passwordFromDB","role_id","password_mobile_pos","Date","now","compare","error","use","passReqToCallback","serializeUser","user","id","deserializeUser","module","exports"],"mappings":"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"}