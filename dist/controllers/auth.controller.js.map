{"version":3,"sources":["../../src/controllers/auth.controller.ts"],"sourcesContent":["import { NextFunction, Request, Response } from 'express';\nimport { CreateUserDto } from '@dtos/users.dto';\nimport { RequestWithUser } from '@interfaces/auth.interface';\nimport { User } from '@interfaces/users.interface';\nimport AuthService from '@services/auth.service';\n// import { pool } from '../database';\nimport PGPool from '@/db_pool/pg_pool';\n\nclass AuthController {\n  public authService = new AuthService();\n\n  public signUp = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userData: CreateUserDto = req.body;\n      const signUpUserData: User = await this.authService.signup(userData);\n\n      res.status(201).json({ data: signUpUserData, message: 'signup' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public logIn = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userData: CreateUserDto = req.body;\n      const { cookie, findUser } = await this.authService.login(userData);\n\n      res.setHeader('Set-Cookie', [cookie]);\n      res.status(200).json({ data: findUser, message: 'login' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public logOut = async (req: RequestWithUser, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userData: User = req.user;\n      const logOutUserData: User = await this.authService.logout(userData);\n\n      res.setHeader('Set-Cookie', ['Authorization=; Max-age=0']);\n      res.status(200).json({ data: logOutUserData, message: 'logout' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public test = async (req: RequestWithUser, res: Response) => {\n    try {\n      const pool = new PGPool();\n      const dataset = await pool.aquery('SELECT * FROM tbl_station WHERE id = 10');\n      console.log(dataset.rows);\n      res.setHeader('Content-Type', 'application/json');\n      return res.end(JSON.stringify(dataset.rows));\n    } catch (err) {\n      console.log(err);\n    }\n    // return res.end(JSON.stringify({\n    //   std: 111,\n    //   name: 'ttt'\n    // }));\n  };\n}\n\nexport default AuthController;\n"],"names":["AuthController","authService","AuthService","signUp","req","res","next","userData","body","signUpUserData","signup","status","json","data","message","error","logIn","cookie","findUser","login","setHeader","logOut","user","logOutUserData","logout","test","pool","PGPool","dataset","aquery","console","log","rows","end","JSON","stringify","err"],"mappings":"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"}